# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

## v2.1.1 - –ù–æ—è–±—Ä—å 2025

### 4. üìÅ –û—à–∏–±–∫–∞ "file is too big" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ —Ä–∞–∑–º–µ—Ä–æ–º > 20 MB –±–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É:
```
Bad Request: file is too big
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Telegram Bot API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:
- **20 MB** –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –±–æ—Ç–æ–≤
- **50 MB** –¥–ª—è Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ Bot API)

–°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ **–¥–æ** –ø–æ–ø—ã—Ç–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
2. –î–æ–±–∞–≤–ª–µ–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ URL –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é (–¥–æ 20 MB)
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–¥–æ 100 MB)
   - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —Å–∂–∞—Ç–∏—é

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ:**
```
‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π!

–†–∞–∑–º–µ—Ä –≤–∞—à–µ–≥–æ –≤–∏–¥–µ–æ: 45.3 MB
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 20 MB

üí° –†–µ—à–µ–Ω–∏–µ:
1. –°–æ–∂–º–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å
2. –£–º–µ–Ω—å—à–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –±–∏—Ç—Ä–µ–π—Ç
3. –°–æ–∫—Ä–∞—Ç–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ

–ü–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è –æ—Ç–ø—Ä–∞–≤—å –≤–∏–¥–µ–æ —Å–Ω–æ–≤–∞.
```

**–§–∞–π–ª—ã:**
- `tg_bot/handlers/format_selection.py` (—Å—Ç—Ä–æ–∫–∏ 188-223, 294-405)

---

## v2.1.1 - –ù–æ—è–±—Ä—å 2025

### 1. ‚ùå –û—à–∏–±–∫–∞ "speed cannot exceed 10" –ø—Ä–∏ –º–æ–Ω—Ç–∞–∂–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –º–æ–Ω—Ç–∞–∂–µ –≤–∏–¥–µ–æ —Å –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–º —Ñ–æ–Ω–æ–≤—ã–º –≤–∏–¥–µ–æ Shotstack API –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É:
```
Value at timeline.tracks[1].clips[1].asset.speed cannot exceed 10
context: {"value": 63.05555833333327}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Shotstack API –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∏–¥–µ–æ –¥–æ **10x**. –ö–æ–≥–¥–∞ —Ñ–æ–Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ –Ω–∞–º–Ω–æ–≥–æ –∫–æ—Ä–æ—á–µ –≥–æ–≤–æ—Ä—è—â–µ–π –≥–æ–ª–æ–≤—ã, —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å —É—Å–∫–æ—Ä–∏—Ç—å –µ–≥–æ –≤ 63 —Ä–∞–∑–∞, —á—Ç–æ –ø—Ä–µ–≤—ã—à–∞–ª–æ –ª–∏–º–∏—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
–í `video_editing/render/shotstack/client.py` –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏:
- –ï—Å–ª–∏ —Ä–∞—Å—á–µ—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å > 10x, –æ–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 10x
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–ª–∏–ø–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∏

**–§–∞–π–ª—ã:**
- `video_editing/render/shotstack/client.py` (—Å—Ç—Ä–æ–∫–∏ 170-181)

---

### 2. üé≠ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç–º–æ—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–≥–¥–∞ GPT –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ç–µ–∫—Å—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–º–æ—Ü–∏—è–º–∏ **–Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `[happy] –ü—Ä–∏–≤–µ—Ç! [sad] –ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ`), —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–ª–∞ —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–≤—É—é —ç–º–æ—Ü–∏—é**, –∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ç–µ–∫—Å—Ç –∏ **–æ–∑–≤—É—á–∏–≤–∞–ª–∏—Å—å –∫–∞–∫ —Ç–µ–∫—Å—Ç**.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
```
–í—Ö–æ–¥ GPT: "[happy] –ü—Ä–∏–≤–µ—Ç! [excited] –Ø —Ä–∞–¥!"
–ü–∞—Ä—Å–∏–Ω–≥: 1 —Å–µ–≥–º–µ–Ω—Ç
  - emotion: "happy"
  - text: "–ü—Ä–∏–≤–µ—Ç! [excited] –Ø —Ä–∞–¥!"  ‚ùå —Ç–µ–≥ –æ–∑–≤—É—á–∏–≤–∞–µ—Ç—Å—è!
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ `r'\[(\w+)\]\s*(.+?)(?=\n\[|\Z)'` –∏—Å–∫–∞–ª–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–≥ —ç–º–æ—Ü–∏–∏ —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏** (`\n[`). –ï—Å–ª–∏ GPT –≤–æ–∑–≤—Ä–∞—â–∞–ª —ç–º–æ—Ü–∏–∏ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ, regex –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª –∏—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–µ–Ω regex –Ω–∞ `r'\[(\w+)\]\s*(.+?)(?=\s*\[|\Z)'`:
- –£–±—Ä–∞–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏ (`\n`)
- –¢–µ–ø–µ—Ä—å –∏—â–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–≥ —ç–º–æ—Ü–∏–∏ —Å –ª—é–±—ã–º –ø—Ä–æ–±–µ–ª–æ–º –∏–ª–∏ –±–µ–∑ –Ω–µ–≥–æ
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç —ç–º–æ—Ü–∏–∏ –∫–∞–∫ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ, —Ç–∞–∫ –∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞:**
```
–í—Ö–æ–¥ GPT: "[happy] –ü—Ä–∏–≤–µ—Ç! [excited] –Ø —Ä–∞–¥!"
–ü–∞—Ä—Å–∏–Ω–≥: 2 —Å–µ–≥–º–µ–Ω—Ç–∞ ‚úÖ
  1. emotion: "happy", text: "–ü—Ä–∏–≤–µ—Ç!"
  2. emotion: "excited", text: "–Ø —Ä–∞–¥!"
```

**–§–∞–π–ª—ã:**
- `tg_bot/services/openai_enhancement_service.py` (—Å—Ç—Ä–æ–∫–∞ 120)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —ç–º–æ—Ü–∏–π
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è raw enhanced text –æ—Ç GPT
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π match —Å emotion –∏ text

---

### 3. üóëÔ∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ–≤–µ—Ä–ª–µ–µ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ —Å—Ç–∞—Ä—ã–µ –æ–≤–µ—Ä–ª–µ–∏ –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å –∏–∑ –∫–µ—à–∞, –∏ —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω—Ç–∞–∂–∞.

**–ü—Ä–∏—á–∏–Ω–∞:**
–§—É–Ω–∫—Ü–∏—è `set_cached_overlay_urls` –Ω–µ –æ—á–∏—â–∞–ª–∞ –ø–æ–ª—è –≤ –ë–î –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –ø—É—Å—Ç—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π `{}`.

**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π –∫–µ—à–∞:
```python
if not overlay_urls and not r2_keys:
    state.cached_overlay_circle_url = None
    state.cached_overlay_circle_r2_key = None
    state.cached_overlay_rect_url = None
    state.cached_overlay_rect_r2_key = None
    state.overlay_cache_created_at = None
```

**–§–∞–π–ª—ã:**
- `tg_bot/utils/user_state.py` (—Å—Ç—Ä–æ–∫–∏ 391-397)
- `tg_bot/handlers/generation.py` (–¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ —ç–º–æ—Ü–∏–π
```python
# –°–æ–∑–¥–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π test_emotion_parsing.py –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
test_cases = [
    "[neutral] –ü—Ä–∏–≤–µ—Ç",                                    # 1 —ç–º–æ—Ü–∏—è
    "[happy] –ü—Ä–∏–≤–µ—Ç!\n[sad] –ì—Ä—É—Å—Ç–Ω–æ",                     # 2 —ç–º–æ—Ü–∏–∏ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º
    "[happy] –ü—Ä–∏–≤–µ—Ç! [sad] –ì—Ä—É—Å—Ç–Ω–æ",                      # 2 —ç–º–æ—Ü–∏–∏ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ ‚úÖ
    "[happy] –ê [excited] –ë [neutral] –í",                  # 3 —ç–º–æ—Ü–∏–∏ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ ‚úÖ
]
```

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ ‚úÖ

---

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `doc/README.md` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–∏–∫—Å—ã –≤ "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ"
- `video_editing/README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤ "–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏"
- `tg_bot/services/openai_enhancement_service.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã docstrings –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ


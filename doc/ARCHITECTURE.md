# üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Datanauts.co UGC Bot

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

Datanauts.co UGC Bot - —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è AI-–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ UGC –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏.

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**
- –ö–∞–∂–¥—ã–π handler –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –æ–±–ª–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –°–µ—Ä–≤–∏—Å—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã
- –£—Ç–∏–ª–∏—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### 2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- **Handlers** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **Services** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
- **Utils** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **Models** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### 3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
- –û–±—â–∏–π dispatcher –¥–ª—è –≤—Å–µ—Ö handlers
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫**
```
User ‚Üí Telegram ‚Üí Bot ‚Üí Handler ‚Üí Service ‚Üí External API
                ‚Üì
            Database ‚Üê Utils ‚Üê Response
```

### 2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
```
Text Input ‚Üí TTS Service ‚Üí Audio File ‚Üí Video Service ‚Üí Final Video
     ‚Üì              ‚Üì           ‚Üì            ‚Üì
User State ‚Üí R2 Storage ‚Üí R2 Storage ‚Üí R2 Storage
```

### 3. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```
FSM State ‚Üí UserState DB ‚Üí Handler Logic ‚Üí Next State
```

## üóÇÔ∏è –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### **handlers/** - –°–ª–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

#### **start.py** - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –ü–µ—Ä–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- /start –∫–æ–º–∞–Ω–¥–∞
- FAQ –∏ –ø–æ–º–æ—â—å
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–µ–Ω—é
```

#### **character_selection.py** - –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –í—ã–±–æ—Ä –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º
- –í—ã–±–æ—Ä –ø–æ–ª–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –í—ã–±–æ—Ä –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –≥–∞–ª–µ—Ä–µ–∏
- –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
```

#### **character_editing.py** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: AI-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å nano-banana service
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

#### **voice_selection.py** - –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ –¥–ª—è –æ–∑–≤—É—á–∫–∏
- –ì–∞–ª–µ—Ä–µ—è –≥–æ–ª–æ—Å–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–ª–æ—Å–æ–≤
- –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –∏ –≥–æ–ª–æ—Å–æ–º
```

#### **generation.py** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ
- –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ fal.ai
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```

#### **my_generations.py** - –ò—Å—Ç–æ—Ä–∏—è
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ñ–∞–π–ª–∞–º
```

#### **feedback.py** - –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- –ü–µ—Ä–µ–¥–∞—á–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∞–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```

#### **credits.py** - –ö—Ä–µ–¥–∏—Ç—ã
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
```

#### **navigation.py** - –ù–∞–≤–∏–≥–∞—Ü–∏—è
```python
# –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
- –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ UGC –ø—Ä–æ—Ü–µ—Å—Å—É
- –ö–æ–º–∞–Ω–¥—ã –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ /main, /create_ads
```

### **services/** - –°–ª–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### **elevenlabs_service.py** - TTS
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: ElevenLabs API
# –§—É–Ω–∫—Ü–∏–∏:
- tts_to_file() - —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
- _synth_sync() - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ API
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ R2 storage
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
```

#### **falai_service.py** - –í–∏–¥–µ–æ
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: fal.ai OmniHuman
# –§—É–Ω–∫—Ü–∏–∏:
- generate_talking_head_video() - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ
- _sync_generate_talking_head() - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ fal.ai
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

#### **nano_banana_service.py** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: fal.ai nano-banana
# –§—É–Ω–∫—Ü–∏–∏:
- edit_character_image() - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- _sync_edit_character_image() - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ R2
```

#### **r2_service.py** - –•—Ä–∞–Ω–∏–ª–∏—â–µ
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: Cloudflare R2
# –§—É–Ω–∫—Ü–∏–∏:
- upload_file() - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- download_file() - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- get_presigned_url() - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- delete_file() - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- configure_lifecycle() - –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
- cleanup_temp_files() - –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

#### **scheduler_service.py** - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
```python
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: APScheduler
# –§—É–Ω–∫—Ü–∏–∏:
- setup_scheduler() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- daily_statistics() - –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- cleanup_tasks() - –∑–∞–¥–∞—á–∏ –æ—á–∏—Å—Ç–∫–∏
```

### **utils/** - –°–ª–æ–π —É—Ç–∏–ª–∏—Ç

#### **logger.py** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- setup_logger() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–æ–≤
- get_logger() - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞
- –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã –¥–ª—è –º–æ–¥—É–ª–µ–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

#### **user_state.py** - –°–æ—Å—Ç–æ—è–Ω–∏–µ
```python
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Character selection (gender, age, page)
- Voice selection (page, voice_id)
- Character editing (paths, iterations)
- Text input (character_text)
- Audio paths (last_audio)
```

#### **credits.py** - –ö—Ä–µ–¥–∏—Ç—ã
```python
# –ö—Ä–µ–¥–∏—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ensure_user() - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- get_credits() - –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- add_credits() - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
- spend_credits() - —Å–ø–∏—Å–∞–Ω–∏–µ
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
```

#### **user_storage.py** - –•—Ä–∞–Ω–∏–ª–∏—â–µ
```python
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- save_user_generation() - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- get_user_generations() - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
- get_user_storage_stats() - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- Presigned URLs –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
```

#### **statistics.py** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```python
# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏
- track_user_activity() - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- get_new_users_count() - –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- get_active_users_count() - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- generate_statistics_report() - –æ—Ç—á–µ—Ç—ã
```

#### **files.py** - –§–∞–π–ª—ã
```python
# –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- list_character_images() - —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- get_character_image() - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- get_character_image_url() - URL –¥–ª—è R2
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ presigned URLs
```

#### **voices.py** - –ì–æ–ª–æ—Å–∞
```python
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞–º–∏
- list_voice_samples() - —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤
- get_voice_sample() - –ø–æ–ª—É—á–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞
- list_all_voice_samples() - –≤—Å–µ –≥–æ–ª–æ—Å–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ R2 –∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
```

#### **audio.py** - –ê—É–¥–∏–æ
```python
# –ê—É–¥–∏–æ —É—Ç–∏–ª–∏—Ç—ã
- check_audio_duration_limit() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤
```

## üîÑ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. **Repository Pattern**
```python
# –í user_state.py
def get_character_gender(tg_id: int) -> Optional[str]:
    with SessionLocal() as db:
        # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
```

### 2. **Service Layer Pattern**
```python
# –í services/
class ElevenLabsService:
    async def tts_to_file(self, text: str, voice_id: str) -> str:
        # –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
```

### 3. **Factory Pattern**
```python
# –í logger.py
def setup_logger(name: str) -> logging.Logger:
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ª–æ–≥–≥–µ—Ä–æ–≤
```

### 4. **Observer Pattern**
```python
# –í statistics.py
def track_user_activity(tg_id: int):
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
users (id, tg_id, credits, selected_voice_id, created_at)

-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_state (user_id, selected_character_idx, character_text, 
           character_gender, character_age, character_page, 
           voice_page, original_character_path, edited_character_path, 
           edit_iteration_count)

-- –ê–∫—Ç–∏–≤—ã (—Ñ–∞–π–ª—ã)
assets (id, user_id, type, path, r2_key, r2_url, r2_url_expires_at, 
        file_size, version, meta_json, created_at)

-- –ò—Å—Ç–æ—Ä–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
credit_logs (id, user_id, delta, reason, created_at)

-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_activity (id, user_id, last_activity_date, created_at)

-- –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
generation_history (id, user_id, generation_type, r2_video_key, 
                   r2_audio_key, r2_image_key, character_gender, 
                   character_age, text_prompt, credits_spent, created_at)
```

### –ò–Ω–¥–µ–∫—Å—ã
```sql
-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_users_tg_id ON users(tg_id);
CREATE INDEX idx_user_state_user_id ON user_state(user_id);
CREATE INDEX idx_assets_user_id ON assets(user_id);
CREATE INDEX idx_credit_logs_user_id ON credit_logs(user_id);
CREATE INDEX idx_generation_history_user_id ON generation_history(user_id);
CREATE INDEX idx_generation_history_created_at ON generation_history(created_at);
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- Telegram ID –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### 2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
- –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
- Rate limiting –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### 3. **–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö**
- Presigned URLs —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
logger.info(f"[UGC] User {user_id} started generation")
logger.error(f"[TTS] Failed to generate audio: {error}")
logger.warning(f"[R2] Upload failed, using local storage")
```

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –¥–µ–Ω—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤
- –û—à–∏–±–∫–∏ API
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Presigned URLs –≤ –ø–∞–º—è—Ç–∏
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**
   - –í—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
   - –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ API –≤—ã–∑–æ–≤—ã

3. **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - Lifecycle policies –≤ R2
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ë–î

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ
TELEGRAM_BOT_TOKEN=...
WEBHOOK_URL=...
DATABASE_URL=...

# AI —Å–µ—Ä–≤–∏—Å—ã
ELEVEN_API_KEY=...
FALAI_API_TOKEN=...

# –•—Ä–∞–Ω–∏–ª–∏—â–µ
R2_ACCESS_KEY_ID=...
R2_SECRET_ACCESS_KEY=...
R2_BUCKET_NAME=...
R2_ENDPOINT_URL=...

# –ê–¥–º–∏–Ω–∫–∞
ADMIN_FEEDBACK_CHAT_ID=...
```

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
```python
# –í constants.py
COST_UGC_VIDEO = 1
DEFAULT_CREDITS = 10
MAX_AUDIO_DURATION = 15.0
R2_URL_EXPIRY_HOURS = 24
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. **Unit —Ç–µ—Å—Ç—ã** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
2. **Integration —Ç–µ—Å—Ç—ã** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π
3. **E2E —Ç–µ—Å—Ç—ã** - –ø–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
4. **Load —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
```python
# –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤
@pytest.fixture
def test_user():
    return User(tg_id=12345, credits=10)

@pytest.fixture
def test_character():
    return {"gender": "male", "age": "young", "index": 0}
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –±–æ—Ç–∞**
2. **Load balancer –¥–ª—è webhook**
3. **Shared database**
4. **Distributed file storage**

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞**
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î**
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
4. **CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤**

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
1. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
2. **Message queues** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
3. **Event sourcing** - –∞—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
4. **CQRS** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **GraphQL API** - –≥–∏–±–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
2. **WebSocket** - real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
4. **Kubernetes** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

**–í–µ—Ä—Å–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**: 2.0  
**–°—Ç–∞—Ç—É—Å**: Production Ready  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –î–µ–∫–∞–±—Ä—å 2024

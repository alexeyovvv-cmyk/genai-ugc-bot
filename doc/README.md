# üé¨ Datanauts.co UGC Bot

Telegram-–±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è UGC-—Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é –ò–ò. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—ã–±–∏—Ä–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö, –≤—ã–±–∏—Ä–∞—Ç—å –≥–æ–ª–æ—Å–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≥—É–±.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
tg_bot/
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è, ~130 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ dispatcher.py              # –û–±—â–∏–π dispatcher –¥–ª—è –≤—Å–µ—Ö handlers
‚îú‚îÄ‚îÄ startup.py                 # –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ db.py                      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models.py                  # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ states.py                  # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îú‚îÄ‚îÄ keyboards.py               # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ admin.py                   # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ handlers/                  # –ú–æ–¥—É–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ start.py              # /start, FAQ, –ø—Ä–æ—Ñ–∏–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ format_selection.py   # –í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –≤–∏–¥–µ–æ (–Ω–æ–≤–æ–µ!)
‚îÇ   ‚îú‚îÄ‚îÄ character_selection.py # –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚îÇ   ‚îú‚îÄ‚îÄ character_editing.py  # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚îÇ   ‚îú‚îÄ‚îÄ voice_selection.py    # –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ generation.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ
‚îÇ   ‚îú‚îÄ‚îÄ my_generations.py     # –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ feedback.py           # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
‚îÇ   ‚îú‚îÄ‚îÄ credits.py            # –ö—Ä–µ–¥–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ navigation.py         # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îú‚îÄ‚îÄ services/                  # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ elevenlabs_service.py # TTS —á–µ—Ä–µ–∑ ElevenLabs
‚îÇ   ‚îú‚îÄ‚îÄ falai_service.py      # –í–∏–¥–µ–æ —á–µ—Ä–µ–∑ fal.ai OmniHuman
‚îÇ   ‚îú‚îÄ‚îÄ nano_banana_service.py # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ fal.ai
‚îÇ   ‚îú‚îÄ‚îÄ r2_service.py         # Cloudflare R2 storage
‚îÇ   ‚îî‚îÄ‚îÄ scheduler_service.py  # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îî‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ logger.py             # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    ‚îú‚îÄ‚îÄ credits.py            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞–º–∏
    ‚îú‚îÄ‚îÄ user_state.py         # –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îú‚îÄ‚îÄ user_storage.py       # –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    ‚îú‚îÄ‚îÄ user_activity.py      # –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ statistics.py          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    ‚îú‚îÄ‚îÄ files.py              # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
    ‚îú‚îÄ‚îÄ voices.py             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞–º–∏
    ‚îú‚îÄ‚îÄ audio.py              # –ê—É–¥–∏–æ —É—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ video.py              # –í–∏–¥–µ–æ —É—Ç–∏–ª–∏—Ç—ã (–Ω–æ–≤–æ–µ!)
    ‚îî‚îÄ‚îÄ constants.py          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
```

## üîß –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏

### 1. **main.py** - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- **–†–∞–∑–º–µ—Ä**: ~130 —Å—Ç—Ä–æ–∫ (–±—ã–ª–æ 1950)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers, –∑–∞–ø—É—Å–∫
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è bot/dispatcher
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö handlers
  - Webhook/polling –ª–æ–≥–∏–∫–∞

### 2. **handlers/** - –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### **start.py** - –ù–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```python
@CommandStart()
async def cmd_start(m: Message)

@dp.callback_query(F.data == "faq")
async def show_faq(c: CallbackQuery)

@dp.callback_query(F.data == "profile")
async def show_profile(c: CallbackQuery)
```

#### **character_selection.py** - –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```python
@dp.callback_query(F.data == "select_character")
async def select_character(c: CallbackQuery, state: FSMContext)

@dp.callback_query(F.data == "gender_male")
async def gender_male_selected(c: CallbackQuery, state: FSMContext)
# –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–∞–ª–µ—Ä–µ—é –±–µ–∑ –≤—ã–±–æ—Ä–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞

@dp.callback_query(F.data.startswith("char_pick:"))
async def character_picked(c: CallbackQuery, state: FSMContext)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```

#### **character_editing.py** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```python
@dp.callback_query(F.data == "edit_character_yes")
async def edit_character_yes(c: CallbackQuery, state: FSMContext)

@dp.message(F.text, UGCCreation.waiting_edit_prompt)
async def handle_edit_prompt(m: Message, state: FSMContext)
```

#### **voice_selection.py** - –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
```python
async def show_voice_gallery(c: CallbackQuery, state: FSMContext)

@dp.callback_query(F.data.startswith("voice_pick:"))
async def voice_picked(c: CallbackQuery, state: FSMContext)
```

#### **generation.py** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```python
@dp.callback_query(F.data == "audio_confirmed")
async def audio_confirmed(c: CallbackQuery, state: FSMContext)

@dp.message(F.text, UGCCreation.waiting_character_text)
async def character_text_received(m: Message, state: FSMContext)
```

### 3. **services/** - –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

#### **elevenlabs_service.py** - TTS
- –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ ElevenLabs API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≥–æ–ª–æ—Å–æ–≤
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ R2 storage

#### **falai_service.py** - –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- Talking head –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ fal.ai OmniHuman
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥—É–± —Å –∞—É–¥–∏–æ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

#### **nano_banana_service.py** - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- AI-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞, –æ–¥–µ–∂–¥—ã, –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å fal.ai nano-banana

#### **r2_service.py** - –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- Cloudflare R2 (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ)
- Presigned URLs –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- Lifecycle policies –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏

### 4. **utils/** - –£—Ç–∏–ª–∏—Ç—ã

#### **logger.py** - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
def setup_logger(name: str, level: int = logging.INFO) -> logging.Logger
def get_logger(name: str) -> logging.Logger

# –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã
ugc_logger = setup_logger("ugc_creation")
tts_logger = setup_logger("tts")
falai_logger = setup_logger("falai")
```

#### **user_state.py** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
```python
# Character selection
set_character_gender(tg_id: int, gender: str)
get_character_gender(tg_id: int) -> Optional[str]
set_character_age(tg_id: int, age: str)  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
get_character_age(tg_id: int) -> Optional[str]

# Pagination
set_character_page(tg_id: int, page: int)
get_character_page(tg_id: int) -> int
set_voice_page(tg_id: int, page: int)
get_voice_page(tg_id: int) -> int

# Character editing
set_original_character_path(tg_id: int, path: str)
set_edited_character_path(tg_id: int, path: str)
clear_edit_session(tg_id: int)
```

#### **credits.py** - –°–∏—Å—Ç–µ–º–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
```python
ensure_user(tg_id: int)  # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–æ–Ω—É—Å–æ–º
get_credits(tg_id: int) -> int
add_credits(tg_id: int, amount: int, reason: str)
spend_credits(tg_id: int, amount: int, reason: str) -> bool
```

## üîÑ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–ª–æ—É

### 1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–∞—á–∞–ª–æ**
```
/start ‚Üí –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å + –±–æ–Ω—É—Å –∫—Ä–µ–¥–∏—Ç—ã
```

### 2. **–í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –≤–∏–¥–µ–æ** (–Ω–æ–≤–æ–µ!)
```
–°–æ–∑–¥–∞—Ç—å UGC (/create –∏–ª–∏ –∫–Ω–æ–ø–∫–∞) ‚Üí –í—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞:
  ‚îú‚îÄ üë§ –ì–æ–≤–æ—Ä—è—â–∞—è –≥–æ–ª–æ–≤–∞ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—ã—á–Ω—ã–π —Ñ–ª–æ—É
  ‚îî‚îÄ üé¨ –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å –±–µ–∫–≥—Ä–∞—É–Ω–¥–æ–º ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ (–º–∞–∫—Å 15 —Å–µ–∫) ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ñ–ª–æ—É
```

**–§–æ—Ä–º–∞—Ç—ã –≤–∏–¥–µ–æ:**
- **–ì–æ–≤–æ—Ä—è—â–∞—è –≥–æ–ª–æ–≤–∞** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —Å AI-–ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
- **–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å –±–µ–∫–≥—Ä–∞—É–Ω–¥–æ–º** - –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞ —Ñ–æ–Ω–µ –≤–∞—à–µ–≥–æ –≤–∏–¥–µ–æ (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ)

### 3. **–°–æ–∑–¥–∞–Ω–∏–µ UGC —Ä–µ–∫–ª–∞–º—ã**
```
–í—ã–±–æ—Ä –ø–æ–ª–∞ ‚Üí –ì–∞–ª–µ—Ä–µ—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç—ã –≤–º–µ—Å—Ç–µ)
```

### 4. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```
–í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å? ‚Üí –ü—Ä–æ–º–ø—Ç ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å/–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å/–û—Ä–∏–≥–∏–Ω–∞–ª
```

### 5. **–í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞**
```
–ì–∞–ª–µ—Ä–µ—è –≥–æ–ª–æ—Å–æ–≤ ‚Üí –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ ‚Üí –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
```

### 6. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**
```
TTS ‚Üí –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏ (SQLAlchemy)

#### **User** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```python
class User(Base):
    id: int = Column(Integer, primary_key=True)
    tg_id: int = Column(BigInteger, unique=True, nullable=False)
    credits: int = Column(Integer, default=0)
    selected_voice_id: Optional[str] = Column(String)
    created_at: datetime = Column(DateTime, default=datetime.utcnow)
```

#### **UserState** - –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
class UserState(Base):
    user_id: int = Column(Integer, ForeignKey("users.id"), primary_key=True)
    selected_character_idx: Optional[int] = Column(Integer)
    character_text: Optional[str] = Column(Text)
    character_gender: Optional[str] = Column(String)
    character_age: Optional[str] = Column(String)
    character_page: int = Column(Integer, default=0)
    voice_page: int = Column(Integer, default=0)
    original_character_path: Optional[str] = Column(String)
    edited_character_path: Optional[str] = Column(String)
    edit_iteration_count: int = Column(Integer, default=0)
    video_format: Optional[str] = Column(String)  # 'talking_head' –∏–ª–∏ 'character_with_background'
    background_video_path: Optional[str] = Column(String)  # R2 –ø—É—Ç—å –∫ —Ñ–æ–Ω–æ–≤–æ–º—É –≤–∏–¥–µ–æ
```

#### **GenerationHistory** - –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
```python
class GenerationHistory(Base):
    id: int = Column(Integer, primary_key=True)
    user_id: int = Column(Integer, ForeignKey("users.id"))
    generation_type: str = Column(String)  # 'video', 'audio'
    r2_video_key: Optional[str] = Column(String)
    r2_audio_key: Optional[str] = Column(String)
    character_gender: Optional[str] = Column(String)
    character_age: Optional[str] = Column(String)
    text_prompt: Optional[str] = Column(Text)
    credits_spent: int = Column(Integer)
    created_at: datetime = Column(DateTime, default=datetime.utcnow)
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
TELEGRAM_BOT_TOKEN=your_bot_token
WEBHOOK_URL=https://your-domain.com/webhook

# AI —Å–µ—Ä–≤–∏—Å—ã
ELEVEN_API_KEY=your_elevenlabs_key
FALAI_API_TOKEN=your_falai_token

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:pass@host:port/db

# R2 Storage
R2_ACCESS_KEY_ID=your_access_key
R2_SECRET_ACCESS_KEY=your_secret_key
R2_BUCKET_NAME=your_bucket
R2_ENDPOINT_URL=https://your-account.r2.cloudflarestorage.com

# –ê–¥–º–∏–Ω–∫–∞
ADMIN_FEEDBACK_CHAT_ID=your_admin_chat_id
```

### Railway —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# 3. –î–µ–ø–ª–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏ push
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m tg_bot.main
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–ø–æ–ª/–≤–æ–∑—Ä–∞—Å—Ç/–≥–∞–ª–µ—Ä–µ—è)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- ‚úÖ –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
- ‚úÖ TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- ‚úÖ –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
from tg_bot.utils.logger import setup_logger

logger = setup_logger(__name__)
logger.info("User action completed")
logger.error("Error occurred")
logger.warning("Warning message")
```

### –õ–æ–≥–∏ –ø–æ –º–æ–¥—É–ª—è–º
- `ugc_creation` - –°–æ–∑–¥–∞–Ω–∏–µ UGC –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `tts` - TTS –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `falai` - –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `r2` - –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- `admin` - –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üîÆ –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (1-2 –Ω–µ–¥–µ–ª–∏)
1. **–£–ª—É—á—à–µ–Ω–∏–µ UI/UX**
   - –ë–æ–ª–µ–µ –∫—Ä–∞—Å–∏–≤—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ R2 URLs
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
   - –ë–æ–ª—å—à–µ –≥–æ–ª–æ—Å–æ–≤ –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
   - –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (1-2 –º–µ—Å—è—Ü–∞)
1. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏**
   - Dashboard –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

2. **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è**
   - –ü–æ–¥–ø–∏—Å–∫–∏
   - –ü–ª–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
   - API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (3+ –º–µ—Å—è—Ü–∞)
1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - Kubernetes —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
   - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **AI/ML —É–ª—É—á—à–µ–Ω–∏—è**
   - –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
   - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

3. **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è —ç–∫—Å–ø–∞–Ω—Å–∏—è**
   - –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
   - –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
   - –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ handler
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `handlers/new_feature.py`
2. –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `handlers/__init__.py`
3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å `@dp.callback_query` –∏–ª–∏ `@dp.message`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `services/new_service.py`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `utils/logger.py` —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ handlers

### –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
1. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤ `models.py`
2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ `startup.py`
3. –û–±–Ω–æ–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—ã –≤ `utils/`

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints
- `/webhook` - Telegram webhook
- `/health` - Health check
- `/` - Root endpoint

### –í–Ω–µ—à–Ω–∏–µ API
- **ElevenLabs** - TTS —Å–∏–Ω—Ç–µ–∑
- **fal.ai** - –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Cloudflare R2** - –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### Git workflow
1. –°–æ–∑–¥–∞—Ç—å feature branch
2. –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
4. –°–æ–∑–¥–∞—Ç—å Pull Request
5. Code review
6. Merge –≤ main

### Code style
- PEP 8 –¥–ª—è Python
- Type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- Docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π logger

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Railway dashboard
2. –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞
3. –°–æ–∑–¥–∞—Ç—å issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–í–µ—Ä—Å–∏—è**: 2.0 (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –î–µ–∫–∞–±—Ä—å 2024  
**–°—Ç–∞—Ç—É—Å**: Production Ready ‚úÖ
